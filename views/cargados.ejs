<!doctype html>
<html lang='es'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <title>Cargados</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css' rel='stylesheet'>
  <link href='/static/css/styles.css' rel='stylesheet'>
  <style>
    .card .btn-close-x {
      position:absolute; top:.4rem; right:.4rem;
    }
  </style>
</head>
<body class='bg-light'>
<%- include('partials/navbar') %>



<main class='container py-3'>

  <form class='row g-2 align-items-end mb-3' method='get' action='/cargados'>
    <div class='col-12 col-md-4'>
      <label class='form-label'>Buscar</label>
      <input class='form-control' name='q' value='<%= q || "" %>' placeholder='Despacho, cliente, etc.'>
    </div>

    <div class='col-6 col-md-2'>
      <label class='form-label'>Aduana</label>
      <select class='form-select' name='aduana'>
        <option value=''>Todas</option>
        <% (aduanas||[]).forEach(function(c){ %>
          <option value='<%= c %>' <%= (fAduana===c?"selected":"") %>><%= c %></option>
        <% }) %>
      </select>
    </div>

    <div class='col-6 col-md-2'>
      <label class='form-label'>Operación</label>
      <select class='form-select' name='operacion'>
        <option value=''>Todas</option>
        <% (operaciones||[]).forEach(function(c){ %>
          <option value='<%= c %>' <%= (fOperacion===c?"selected":"") %>><%= c %></option>
        <% }) %>
      </select>
    </div>

    <div class='col-6 col-md-2'>
      <label class='form-label'>Ejecutivo</label>
      <select class='form-select' name='ejecutivo'>
        <option value=''>Todos</option>
        <% (ejecutivos||[]).forEach(function(c){ %>
          <option value='<%= c %>' <%= (fEjecutivo===c?"selected":"") %>><%= c %></option>
        <% }) %>
      </select>
    </div>

    <div class='col-6 col-md-2'>
      <label class='form-label'>ETA desde</label>
      <input type='date' class='form-control' name='etafrom' value='<%= fEtaFrom || "" %>'>
    </div>

    <div class='col-6 col-md-2'>
      <label class='form-label'>ETA hasta</label>
      <input type='date' class='form-control' name='etato' value='<%= fEtaTo || "" %>'>
    </div>

    <div class='col-12 col-md-2'>
      <button class='btn btn-primary w-100' type='submit'>Aplicar</button>
    </div>
    <div class='col-12 col-md-2'>
      <a class='btn btn-outline-secondary w-100' href='/cargados'>Limpiar</a>
    </div>
  </form>

  <div class='row g-3'>

    <div class='col-lg-4'>
      <h5>
        <span class='badge bg-dark'>&nbsp;</span>
        PROVISIÓN
        <span class='badge text-bg-light ms-2'><%= (provision||[]).length %></span>
      </h5>
      <div class='d-flex flex-wrap gap-2'>
        <% if(!(provision||[]).length){ %>
          <div class='text-muted small'>Sin elementos</div>
        <% } %>

        <% (provision||[]).forEach(function(item){ %>
          <div class='card shadow-sm <%= item.colorCls || "" %>' style='min-width:260px; max-width:320px;'>
            <div class='card-body position-relative'>
              <button type='button'
                      class='btn btn-sm btn-outline-danger btn-close-x btn-cargado-remove'
                      data-d='<%= item.despacho %>'
                      title='Quitar de Cargados'>✕</button>

              <div class='d-flex justify-content-between'>
                <div>
                  <div class='fw-semibold'><%= item.despacho %></div>
                  <div class='text-muted small'><%= item.cliente || "" %></div>
                  <div class='text-muted small'>ETA: <%= item.etaFmt || "—" %></div>
                </div>
                <span class='badge text-bg-<%= item.statusColor %>'><%= item.statusLabel %></span>
              </div>

              <% if(item.pdf){ %>
                <div class='mt-2'>
                  <a class='btn btn-sm btn-outline-primary' href='<%= item.pdf %>' target='_blank'>Ver PDF</a>
                </div>
              <% } %>
            </div>
          </div>
        <% }) %>
      </div>
    </div>

    <div class='col-lg-8'>
      <h5>
        <span class='badge bg-success'>&nbsp;</span>
        Asignados
        <span class='badge text-bg-light ms-2'><%= (completa||[]).length %></span>
      </h5>
      <div class='d-flex flex-wrap gap-2'>
        <% if(!(completa||[]).length){ %>
          <div class='text-muted small'>Sin elementos</div>
        <% } %>

        <% (completa||[]).forEach(function(item){ %>
          <div class='card shadow-sm <%= item.colorCls || "" %>' style='min-width:260px; max-width:320px;'>
            <div class='card-body position-relative'>
              <button type='button'
                      class='btn btn-sm btn-outline-danger btn-close-x btn-cargado-remove'
                      data-d='<%= item.despacho %>'
                      title='Quitar de Cargados'>✕</button>

              <div class='d-flex justify-content-between'>
                <div>
                  <div class='fw-semibold'><%= item.despacho %></div>
                  <div class='text-muted small'><%= item.cliente || "" %></div>
                  <div class='text-muted small'>Pedidor: <%= item.pedidor || "—" %></div>
                  <div class='text-muted small'>ETA: <%= item.etaFmt || "—" %></div>
                </div>
                <span class='badge text-bg-<%= item.statusColor %>'><%= item.statusLabel %></span>
              </div>

              <% if(item.pdf){ %>
                <div class='mt-2'>
                  <a class='btn btn-sm btn-outline-primary' href='<%= item.pdf %>' target='_blank'>Ver PDF</a>
                </div>
              <% } %>
            </div>
          </div>
        <% }) %>
      </div>
    </div>

  </div>
</main>

<div id='toastContainer' class='toast-container position-fixed bottom-0 end-0 p-3'></div>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js' defer></script>
<script src='/static/js/app.js' defer></script>
</body>
</html>
